create or replace function update_sequence(p_id bigint, p_name text, p_duration integer, p_level text, p_focus text, p_poses jsonb, p_user_id uuid) returns json language plpgsql security definer as $$ begin update sequences set name = p_name, duration = p_duration, level = p_level, focus = p_focus, poses = p_poses, updated_at = now() where id = p_id and user_id = p_user_id; return json_build_object('success', found, 'message', case when found then 'Sequence updated' else 'Sequence not found' end); end; $$;
